{"version":3,"file":"useSuspenseAssets.mjs","sources":["../../src/hooks/useSuspenseAssets.ts"],"sourcesContent":["import {\n    Assets,\n    Cache,\n} from 'pixi.js';\nimport { getAssetKey } from '../helpers/getAssetKey';\n\nimport type { AssetRetryState } from '../typedefs/AssetRetryState';\nimport type { UnresolvedAsset } from '../typedefs/UnresolvedAsset';\nimport type { UseAssetsOptions } from '../typedefs/UseAssetsOptions';\n\nconst errorCache: Map<UnresolvedAsset, AssetRetryState> = new Map();\n\nfunction assetsLoadedTest<T>(asset: UnresolvedAsset<T>)\n{\n    return Cache.has(getAssetKey(asset));\n}\n\n/** Loads assets, returning a hash of assets once they're loaded. Must be inside of a `<Suspense>` component. */\nexport function useSuspenseAssets<T = any>(\n    /** @description Assets to be loaded. */\n    assets: UnresolvedAsset[],\n    /** @description Asset options. */\n    options: UseAssetsOptions = {},\n): T[]\n{\n    if (typeof window === 'undefined')\n    {\n        throw Object.assign(Error('`useAssets` will only run on the client.'), {\n            digest: 'BAILOUT_TO_CLIENT_SIDE_RENDERING',\n        });\n    }\n\n    const {\n        maxRetries = 3,\n        onError,\n        onProgress,\n        retryOnFailure = true,\n    } = options;\n\n    const allAssetsAreLoaded = assets.some(assetsLoadedTest<T>);\n\n    if (!allAssetsAreLoaded)\n    {\n        let cachedState = errorCache.get(assets);\n\n        // Rethrow the cached error if we are not retrying on failure or have reached the max retries\n        if (cachedState && (!retryOnFailure || cachedState.retries > maxRetries))\n        {\n            if (typeof onError === 'function')\n            {\n                onError(cachedState.error);\n            }\n            else\n            {\n                throw cachedState.error;\n            }\n        }\n\n        throw Assets\n            .load<T>(assets, (progressValue) =>\n        {\n            if (typeof onProgress === 'function')\n            {\n                onProgress(progressValue);\n            }\n        })\n            .catch((error) =>\n            {\n                if (!cachedState)\n                {\n                    cachedState = {\n                        error,\n                        retries: 0,\n                    };\n                }\n\n                errorCache.set(assets, {\n                    ...cachedState,\n                    error,\n                    retries: cachedState.retries + 1,\n                });\n            });\n    }\n\n    const assetKeys = assets.map((asset: UnresolvedAsset<T>) => getAssetKey(asset));\n    const resolvedAssetsDictionary = Assets.get<T>(assetKeys) as Record<string, T>;\n\n    return assets.map((_asset: UnresolvedAsset<T>, index: number) => resolvedAssetsDictionary[index]);\n}\n"],"names":[],"mappings":";;;;AAUA,MAAM,UAAA,uBAAwD,GAAI,EAAA,CAAA;AAElE,SAAS,iBAAoB,KAC7B,EAAA;AACI,EAAA,OAAO,KAAM,CAAA,GAAA,CAAI,WAAY,CAAA,KAAK,CAAC,CAAA,CAAA;AACvC,CAAA;AAGO,SAAS,iBAEZ,CAAA,MAAA,EAEA,OAA4B,GAAA,EAEhC,EAAA;AACI,EAAI,IAAA,OAAO,WAAW,WACtB,EAAA;AACI,IAAA,MAAM,MAAO,CAAA,MAAA,CAAO,KAAM,CAAA,0CAA0C,CAAG,EAAA;AAAA,MACnE,MAAQ,EAAA,kCAAA;AAAA,KACX,CAAA,CAAA;AAAA,GACL;AAEA,EAAM,MAAA;AAAA,IACF,UAAa,GAAA,CAAA;AAAA,IACb,OAAA;AAAA,IACA,UAAA;AAAA,IACA,cAAiB,GAAA,IAAA;AAAA,GACjB,GAAA,OAAA,CAAA;AAEJ,EAAM,MAAA,kBAAA,GAAqB,MAAO,CAAA,IAAA,CAAK,gBAAmB,CAAA,CAAA;AAE1D,EAAA,IAAI,CAAC,kBACL,EAAA;AACI,IAAI,IAAA,WAAA,GAAc,UAAW,CAAA,GAAA,CAAI,MAAM,CAAA,CAAA;AAGvC,IAAA,IAAI,WAAgB,KAAA,CAAC,cAAkB,IAAA,WAAA,CAAY,UAAU,UAC7D,CAAA,EAAA;AACI,MAAI,IAAA,OAAO,YAAY,UACvB,EAAA;AACI,QAAA,OAAA,CAAQ,YAAY,KAAK,CAAA,CAAA;AAAA,OAG7B,MAAA;AACI,QAAA,MAAM,WAAY,CAAA,KAAA,CAAA;AAAA,OACtB;AAAA,KACJ;AAEA,IAAA,MAAM,MACD,CAAA,IAAA,CAAQ,MAAQ,EAAA,CAAC,aACtB,KAAA;AACI,MAAI,IAAA,OAAO,eAAe,UAC1B,EAAA;AACI,QAAA,UAAA,CAAW,aAAa,CAAA,CAAA;AAAA,OAC5B;AAAA,KACH,CAAA,CACI,KAAM,CAAA,CAAC,KACR,KAAA;AACI,MAAA,IAAI,CAAC,WACL,EAAA;AACI,QAAc,WAAA,GAAA;AAAA,UACV,KAAA;AAAA,UACA,OAAS,EAAA,CAAA;AAAA,SACb,CAAA;AAAA,OACJ;AAEA,MAAA,UAAA,CAAW,IAAI,MAAQ,EAAA;AAAA,QACnB,GAAG,WAAA;AAAA,QACH,KAAA;AAAA,QACA,OAAA,EAAS,YAAY,OAAU,GAAA,CAAA;AAAA,OAClC,CAAA,CAAA;AAAA,KACJ,CAAA,CAAA;AAAA,GACT;AAEA,EAAA,MAAM,YAAY,MAAO,CAAA,GAAA,CAAI,CAAC,KAA8B,KAAA,WAAA,CAAY,KAAK,CAAC,CAAA,CAAA;AAC9E,EAAM,MAAA,wBAAA,GAA2B,MAAO,CAAA,GAAA,CAAO,SAAS,CAAA,CAAA;AAExD,EAAA,OAAO,OAAO,GAAI,CAAA,CAAC,QAA4B,KAAkB,KAAA,wBAAA,CAAyB,KAAK,CAAC,CAAA,CAAA;AACpG;;;;"}