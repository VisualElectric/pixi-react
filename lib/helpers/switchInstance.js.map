{"version":3,"file":"switchInstance.js","sources":["../../src/helpers/switchInstance.ts"],"sourcesContent":["import { appendChild } from './appendChild';\nimport { createInstance } from './createInstance';\nimport { removeChild } from './removeChild';\n\nimport type { Fiber } from 'react-reconciler';\nimport type { HostConfig } from '../typedefs/HostConfig';\n\nexport function switchInstance(\n    instance: HostConfig['instance'],\n    type: HostConfig['type'],\n    newProps: HostConfig['props'],\n    fiber: Fiber,\n)\n{\n    const parent = instance.__pixireact?.parent;\n\n    if (!parent)\n    {\n        return;\n    }\n\n    const root = instance.__pixireact.root as HostConfig['containerInstance'];\n    const newInstance = createInstance(type, newProps, root);\n\n    if (!instance.__pixireact.autoRemovedBeforeAppend)\n    {\n        removeChild(parent, instance);\n    }\n\n    if (newInstance.parent)\n    {\n        newInstance.__pixireact.autoRemovedBeforeAppend = true;\n    }\n\n    appendChild(parent as HostConfig['containerInstance'], newInstance);\n\n    // This evil hack switches the react-internal fiber node\n    // https://github.com/facebook/react/issues/14983\n    // https://github.com/facebook/react/pull/15021\n    const fibers = [fiber, fiber.alternate];\n\n    fibers.forEach((fiber) =>\n    {\n        if (fiber !== null)\n        {\n            fiber.stateNode = newInstance;\n\n            if (fiber.ref)\n            {\n                if (typeof fiber.ref === 'function')\n                {\n                    fiber.ref(newInstance);\n                }\n                else\n                {\n                    const ref = fiber.ref;\n\n                    ref.current = newInstance;\n                }\n            }\n        }\n    });\n}\n"],"names":["createInstance","removeChild","appendChild","fiber"],"mappings":";;;;;;;AAOO,SAAS,cACZ,CAAA,QAAA,EACA,IACA,EAAA,QAAA,EACA,KAEJ,EAAA;AACI,EAAM,MAAA,MAAA,GAAS,SAAS,WAAa,EAAA,MAAA,CAAA;AAErC,EAAA,IAAI,CAAC,MACL,EAAA;AACI,IAAA,OAAA;AAAA,GACJ;AAEA,EAAM,MAAA,IAAA,GAAO,SAAS,WAAY,CAAA,IAAA,CAAA;AAClC,EAAA,MAAM,WAAc,GAAAA,6BAAA,CAAe,IAAM,EAAA,QAAA,EAAU,IAAI,CAAA,CAAA;AAEvD,EAAI,IAAA,CAAC,QAAS,CAAA,WAAA,CAAY,uBAC1B,EAAA;AACI,IAAAC,uBAAA,CAAY,QAAQ,QAAQ,CAAA,CAAA;AAAA,GAChC;AAEA,EAAA,IAAI,YAAY,MAChB,EAAA;AACI,IAAA,WAAA,CAAY,YAAY,uBAA0B,GAAA,IAAA,CAAA;AAAA,GACtD;AAEA,EAAAC,uBAAA,CAAY,QAA2C,WAAW,CAAA,CAAA;AAKlE,EAAA,MAAM,MAAS,GAAA,CAAC,KAAO,EAAA,KAAA,CAAM,SAAS,CAAA,CAAA;AAEtC,EAAO,MAAA,CAAA,OAAA,CAAQ,CAACC,MAChB,KAAA;AACI,IAAA,IAAIA,WAAU,IACd,EAAA;AACI,MAAAA,OAAM,SAAY,GAAA,WAAA,CAAA;AAElB,MAAA,IAAIA,OAAM,GACV,EAAA;AACI,QAAI,IAAA,OAAOA,MAAM,CAAA,GAAA,KAAQ,UACzB,EAAA;AACI,UAAAA,MAAAA,CAAM,IAAI,WAAW,CAAA,CAAA;AAAA,SAGzB,MAAA;AACI,UAAA,MAAM,MAAMA,MAAM,CAAA,GAAA,CAAA;AAElB,UAAA,GAAA,CAAI,OAAU,GAAA,WAAA,CAAA;AAAA,SAClB;AAAA,OACJ;AAAA,KACJ;AAAA,GACH,CAAA,CAAA;AACL;;;;"}